<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SBP Guardrails</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<div class="header">
    <h1>SBP GUARDRAILS</h1>
    <div class="user">
       <strong>Welcome {{ name }}</strong> <br>
        <a href="{{ url_for('hello_world') }}">Logout</a>
    </div>
</div>

<p class="subtitle"><strong>Choose all GuardRails that you want to enable</strong></p>

<form method="POST" action="{{ url_for('submit_guardrails') }}">
<div class="options">

    <div class="option">
        <input type="checkbox" name = "guardrails" value = "bannedwords"  data-name = "Banned Words" onchange="updateSelected()"> Banned Words <br><span>Validates that the output does not contain banned words.</span>
    </div>

    <div class="option">
        <input type="checkbox" name = "guardrails" value = "bias" data-name = "Bias Check" onchange="updateSelected()"> Bias Check <br><span>Validates that the text is free from biases related to age, gender, sex, ethnicity, religion, etc.</span>
    </div>

    <div class="option competitor-option">
    <input type="checkbox" name="guardrails" value="competitor" data-name="Competitor Check"
            onchange="updateSelected(); toggleCompetitor(this)">
    Competitor Check<br>
    <span>Flags mentions of competitors and fixes responses by filtering out competitor names.</span>

    <div class="sublist competitor-sublist" style="display:none;">
        {% for c in competitors %}
        <label>
            <input type="checkbox" name="sub_competitor" value="{{ c }}" onchange="updateSelected()"> {{ c }}
        </label><br>
        {% endfor %}
    </div>
    <input type="text" class="text-input competitor-input"
            name="input_competitor" placeholder="Other competitors:" style="display:none;">
    </div>



    <div class="option">
        <input type="checkbox" name="guardrails" value="cucumberexp" data-name="Cucumber Expression Match" onchange="updateSelected(); toggleInput(this)">Cucumber Expression Match<br>
        <span>Validates that the input string matches a specified cucumber expression.</span>
        <input type="text" class="text-input" name="input_cucumberexp" placeholder="Enter cucumber expression:" style="display:none;">
    </div>


    <div class="option">
        <input type="checkbox" name="guardrails" value="detectpii" data-name="Detect PII" onchange="updateSelected(); togglePII(this)"> Detect PII <br>
        <span>Detects personally identifiable information (PII) in text.</span>
    <div class="sublist" id="piiSublist">
    <label><input type="checkbox" name="sub_detectpii" value="email" onchange="updateSelected()"> Email</label><br>
    <label><input type="checkbox" name="sub_detectpii" value="phone" onchange="updateSelected()"> Phone</label><br>
    <label><input type="checkbox" name="sub_detectpii" value="aadhaar" onchange="updateSelected()"> Aadhaar</label><br>
    <label><input type="checkbox" name="sub_detectpii" value="ip_address" onchange="updateSelected()"> IP_Address</label><br>
    <label><input type="checkbox" name="sub_detectpii" value="date_time" onchange="updateSelected()"> Date_Time</label>
    </div>

    </div>
        <div class="option">
            <input type="checkbox" name = "guardrails" value = "url" data-name = "Has Valid URL" onchange="updateSelected()"> Has Valid URL <br><span>Ensures generated content contains a valid URL.</span>
        </div>

        <div class="option">
            <input type="checkbox" name = "guardrails" value = "profanity" data-name = "Profanity Free" onchange="updateSelected()"> Profanity Free <br><span>Checks for profanity in text.</span>
        </div>

        <div class="option">
            <input type="checkbox" name = "guardrails" value = "secret" data-name = "Secrets Present" onchange="updateSelected()"> Secrets Present <br><span>Detects secrets such as API keys using common patterns.</span>
        </div>

        <div class="option">
        <input type="checkbox" name="guardrails" value="codefinder" data-name="Code Finder" onchange="updateSelected(); toggleCode(this)"> Code Finder<br>
        <span>Ensures content does not contain any code.</span>
        <div class="sublist" id="codeSublist">
        <label><input type="checkbox" name="sub_codefinder" value="python" onchange="updateSelected()"> Python</label><br>
        <label><input type="checkbox" name="sub_codefinder" value="java" onchange="updateSelected()"> Java</label><br>
        <label><input type="checkbox" name="sub_codefinder" value="c++" onchange="updateSelected()"> C++</label><br>
        </div>
</div>


<div class="selected-box">
    <strong>Selected modules:</strong>
    <p id="selectedText"></p>
</div>


<button type="submit" class="submit-btn">Submit</button>
</form>
</form>


<script>
//function for validator selection
function updateSelected() {
    const parents = document.querySelectorAll('input[name="guardrails"]');
    let output = [];

    parents.forEach(p => {
        if (p.checked) {
            const name = p.dataset.name;
            const subKey = "sub_" + p.value;
            const subs = document.querySelectorAll(`input[name="${subKey}"]:checked`);

            if (subs.length > 0) {
                let subNames = [];
                subs.forEach(s => subNames.push(s.value));
                output.push(`${name} (${subNames.join(", ")})`);
            } else {
                output.push(name);
            }
        }
    });

    document.getElementById("selectedText").innerText = output.join(", ");
}

//function for detectPII sub-list
function togglePII(checkbox) {
    const sublist = document.getElementById("piiSublist");
    sublist.style.display = checkbox.checked ? "block" : "none";
}

//function for codeFinder sub-list
function toggleCode(checkbox) {
    const sublist = document.getElementById("codeSublist");
    sublist.style.display = checkbox.checked ? "block" : "none";
}

//function for inputbox
function toggleInput(checkbox) {
    const input = checkbox.parentElement.querySelector(".text-input");
    if (!input) return;
    input.style.display = checkbox.checked ? "block" : "none";
    if (!checkbox.checked) input.value = "";
}

function toggleCompetitor(checkbox) {
    const container = checkbox.closest('.competitor-option');
    if (!container) return;

    const sublist = container.querySelector('.competitor-sublist');
    const input = container.querySelector('.competitor-input');

    if (checkbox.checked) {
        if (sublist) sublist.style.display = 'block';
        if (input) input.style.display = 'block';
    } else {
        if (sublist) {
            sublist.style.display = 'none';
            sublist.querySelectorAll('input').forEach(cb => cb.checked = false);
        }
        if (input) {
            input.style.display = 'none';
            input.value = '';
        }
    }
}



</script>
</body>
</html>
